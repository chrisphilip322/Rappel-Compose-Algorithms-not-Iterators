<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>reveal.js</title>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/black.css">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css">
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section data-markdown>
          <textarea data-template>
# Rappel
### Compose Algorithms, not Iterators
#### Google's Alternative to Ranges

Authors: Chris Philip and John Bandela  
Presented by: John Bandela at CppNow 2024
---
## Why Rappel?
---
### Composition
---
`Compose` is just a regular stage
```c++ [2|7]
auto FlattenOptional() {
  return rpl::Compose(rpl::Filter(), rpl::Deref());
}

rpl::Apply(
  std::vector<std::optional<int>>{1, std::nullopt, 3},
  FlattenOptional(),
  rpl::To<std::vector>());
```
---
`Compose` generators
```c++ [2-4|8]
auto PerfectSquares() {
  return rpl::Compose(
    rpl::Iota(1),
    rpl::Transform([](int i) { return i*i; }));
}

rpl::Apply(
  PerfectSquares(),
  rpl::Filter([](int i) { return i >= 100; }),
  rpl::Take(5),
  rpl::To<std::vector>());
```
---
`Compose` ranges
```c++ [5-7]
struct Transactions {
  std::vector<double> amounts;

  auto Credits() {
    return rpl::Compose(
      std::cref(amounts),
      rpl::Filter([](double d) { return d > 0; }));
  }
};
```
---
### Multi-Value Streams
---
Multi-value streams are passed as seperate arguments
```c++ [2|3|4|5]
std::map<int, std::vector<int>> values = {...};
rpl::Apply(values,              // pair<int, vector>
           rpl::ExpandTuple(),  // int, vector
           rpl::Flatten(),      // int, int
           rpl::ForEach([](int k, int v) { ... }));
```
---
First class support
```c++ [5-6]
std::map<std::string, int> name2age = {...};
auto age2name = rpl::Apply(
  std::move(name2age),
  rpl::ExpandTuple(),
  rpl::Swizzle<1, 0>(),
  rpl:ToMap<std::map>());
```
---
"Correct" Reference Semantics
```c++ [4-5|6-8]
std::vector<std::unique_ptr<int>> values = {...};
rpl::Apply(
  values,
  rpl::ZipResult([](const auto& ptr) {
    return std::make_unique<int>(*ptr); }),
  rpl::ForEach([](
    std::same_as<const std::unique_ptr<int>&> auto&& first,
    std::same_as<std::unique_ptr<int>> auto&& second) {}));
```
---
Error Handling
---
Short-circuit on error and wrap results
```c++ [6|7|8|9|4-9]
std::optional<int> ParseInt(std::string_view);

std::vector<std::optional<std::string>> values = {...};
std::optional<int> sum = rpl::Apply(
  values,                     // optional<string>
  rpl::UnwrapOptional(),      // string
  rpl::Transform(&ParseInt),  // optional<int>
  rpl::UnwrapOptional(),      // int
  rpl::Accumulate());         // int
```
---
Monadic style
```c++ [6-8|10-14]
std::optional<int> ParseInt(std::string_view);
int Squared(int i);

std::optional<std::string> value = ...;

std::optional<int> cpp23 = value
  .and_then(&ParseInt)
  .transform(&Squared);

std::optional<int> rappel = rpl::Apply(
  value,
  rpl::UnwrapOptionalComplete(),
  rpl::TransformComplete(&ParseInt),
  rpl::TransformComplete(&Squared));
```
          </textarea>
        </section>
      </div>
    </div>

    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script>
      // More info about initialization & config:
      // - https://revealjs.com/initialization/
      // - https://revealjs.com/config/
      Reveal.initialize({
        hash: true,

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
      });
    </script>
  </body>
</html>
